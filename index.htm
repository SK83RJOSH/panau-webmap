<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Three.js</title>
	<script src="http://threejs.org/build/three.min.js"></script>
	<script>
		var dragging, mouseX, mouseY;
		var scene, camera, ambient, shader, renderer;
		var geometry, texture, displacement, uniforms, material, mesh;

		function init() {
			scene = new THREE.Scene();

			camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 1, 10000);
			camera.position.z = 15;

			shader = THREE.ShaderLib['normalmap'];
			geometry = new THREE.PlaneGeometry(16, 16, 256, 256);
			geometry.computeTangents();
			texture = THREE.ImageUtils.loadTexture('map_diffuse_low.jpg');
			texture.minFilter = THREE.LinearFilter;
			texture.magFilter = THREE.LinearFilter;
			displacement = THREE.ImageUtils.loadTexture('map_displacement.jpg');

			uniforms = THREE.UniformsUtils.clone(shader.uniforms);
			uniforms["enableDiffuse"].value = true;
			uniforms["tDiffuse"].value = texture;
			uniforms["enableDisplacement"].value = true;
			uniforms["tDisplacement"].value = displacement;
			uniforms["uDisplacementScale"].value = 1.15;
			
			material = new THREE.ShaderMaterial({
				fragmentShader: shader.fragmentShader,
				vertexShader: shader.vertexShader,
				uniforms: uniforms,
				lights: true
			});

			mesh = new THREE.Mesh(geometry, material);
			mesh.rotation.x = -65 * 0.0174532925;
			scene.add(mesh);

			ambientLight = new THREE.AmbientLight(0xffffff);
			scene.add( ambientLight );

			renderer = new THREE.WebGLRenderer();
			renderer.setSize(window.innerWidth, window.innerHeight);
			renderer.antialiasing = true;
			renderer.physicallyBasedShading = true;

			document.body.appendChild(renderer.domElement);
			document.body.addEventListener('mousewheel', function(event) {
				camera.position.z -= event.wheelDeltaY * 0.0174532925;
			});
		}

		function animate() {
			requestAnimationFrame(animate);
			renderer.render(scene, camera);
		}

		window.addEventListener('resize', function() {
			camera.aspect = window.innerWidth / window.innerHeight;
			camera.updateProjectionMatrix();
			renderer.setSize(window.innerWidth, window.innerHeight);
		});

		window.addEventListener('mousedown', function(event) {
			dragging = true;

			lastX = event.clientX;
			lastY = event.clientY;
		});

		window.addEventListener('mousemove', function(event) {
			if(dragging) {
				mesh.rotation.z += (lastX - event.clientX) * 0.0174532925;
				mesh.rotation.x += (lastY - event.clientY) * 0.0174532925;
			}

			lastX = event.clientX;
			lastY = event.clientY;
		});

		window.addEventListener('mouseup', function(event) {
			dragging = false;

			lastX = event.clientX;
			lastY = event.clientY;
		});
	</script>
	<style>
		body, html {
			padding: 0;
			margin: 0;
			overflow: hidden;
		}

		canvas {
			position: fixed;
			width: 100%;
			height: 100%;
		}
	</style>
</head>
<body onload="init(); animate();"></body>
</html>